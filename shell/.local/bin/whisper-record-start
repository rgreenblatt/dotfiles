#!/usr/bin/env python3
"""Start recording audio for whisper transcription."""

import subprocess
import os
import signal

RECORDING_FILE = "/tmp/whisper-recording.wav"
PID_FILE = "/tmp/whisper-recording.pid"

# Kill any existing recording
if os.path.exists(PID_FILE):
    try:
        with open(PID_FILE) as f:
            old_pid = int(f.read().strip())
        os.kill(old_pid, signal.SIGINT)
    except (ProcessLookupError, ValueError):
        pass
    os.unlink(PID_FILE)

# Remove old recording
if os.path.exists(RECORDING_FILE):
    os.unlink(RECORDING_FILE)

# Start recording (16kHz mono for whisper)
proc = subprocess.Popen(
    ["rec", "-q", "-r", "16000", "-c", "1", RECORDING_FILE],
    stdout=subprocess.DEVNULL,
    stderr=subprocess.DEVNULL,
)

# Save PID
with open(PID_FILE, "w") as f:
    f.write(str(proc.pid))
